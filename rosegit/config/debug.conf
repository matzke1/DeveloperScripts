# Modifies configuration to add debugging features					-*- shell-script -*-

# Add -g to compiler switches
RG_CONFIGURE=$(eval args-adjust --with-C_DEBUG=-g $RG_CONFIGURE)
RG_CONFIGURE=$(eval args-adjust --with-CXX_DEBUG=-g $RG_CONFIGURE)

# Make sure we have a frame pointer or gdb-based debuggers don't work well
RG_CONFIGURE=$(eval args-adjust --with-C_OPTIMIZE-=-fomit-frame-pointer $RG_CONFIGURE)
RG_CONFIGURE=$(eval args-adjust --with-CXX_OPTIMIZE-=-fomit-frame-pointer $RG_CONFIGURE)


# Add iterator assertions, but a different version of Boost and Wt are needed.
# Note: iterator assertions are serial in nature; running with lots of threads will actually be slower than
#       running with few threads when _GLIBCXX_DEBUG is defined.
# Note: boost::regex_search etc will throw std::bad_alloc when compiled with _GLIBCXX_DEBUG, so this is disabled
#       now. [2014-10-23].
if false; then
    if [ -d "$BOOST_ROOT-debug" ]; then
	RG_CONFIGURE=$(eval args-adjust --with-CXX_DEBUG+=-D_GLIBCXX_DEBUG $RG_CONFIGURE)
	BOOST_ROOT="$BOOST_ROOT-debug"
	RG_CONFIGURE=$(eval args-adjust --with-boost=$BOOST_ROOT $RG_CONFIGURE)

	if [ "$WT_ROOT" != "" ]; then
	    if [ -d "$WT_ROOT-debug" ]; then
		WT_ROOT="$WT_ROOT-debug"
		RG_CONFIGURE=$(eval args-adjust --with-wt=$WT_ROOT $RG_CONFIGURE)
	    else
		echo "No debug version of Wt" >&2
		exit 1
	    fi
	fi
    else
	rosegit_die "cannot find a debug version of boost"
    fi
fi
